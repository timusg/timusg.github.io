
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>code test and automate infrastructure - part II |  timusg (sumit gupta)</title>
	<meta name="author" content="timusg">

	
	<meta name="description" content="Code Test and Automate Infrastructure - Part II Dec 9th, 2013 Part Two - Testing Good code evolve with tests and CI is vital part of development &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Sumit Gupta's Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://timusg.github.io/blog/2013/12/09/code-test-and-automate-infrastructure-part-ii/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profile-container">
  <div class="profilepic">
    <script src="/javascripts/md5.js"></script>
    <script type="text/javascript">
$(function(){
  $('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("timusga@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
});
    </script>
  </div>

  <hgroup>
  <h1 class="site-title"><a href="/">Sumit Gupta's Blog</a></h1>
  
  <p class="site-subtitle">code to production and every thing in between</p>
  
  </hgroup>
 <nav id="sub-nav">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/timusg" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/timusg" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</div>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>

</header>
			</div>
		</div>
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="article-inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
	<h1 class="title" itemprop="name">Code Test and Automate Infrastructure - Part II</h1>
  








  



  <div class="post-date"><time datetime="2013-12-09T18:54:00+05:30" data-updated="true" itemprop="datePublished">Dec 9<span>th</span>, 2013</time></div>
	<div class="entry-content" itemprop="articleBody"><h2>Part Two  - Testing</h2>

<p>Good code evolve with tests and CI is vital part of development cycle specially if multiple developers are working on the same code base,
these development practices also worth when applied to the infrastructure code.</p>

<p>One compelling reason for not doing so is that as compared to application code, infrastructure code is more resilient and not frequently changes. But still automated tests not only ensure sanity of code but often fasten development speed by reducing lot
of time required for manual testing of changes.</p>

<!--more-->


<h3>Codebase changes for testing</h3>

<p>As mentioned in <a href="/blog/2013/11/07/code-test-and-automate-infrastructure/">first part</a> one repo per cookbook for
modularity also simplify the independent testing of the cookbook,
but don&#8217;t worry if you have legacy codebase, there are also tools like <a href="https://github.com/customink/strainer">strainer</a> which simplify testing of monolithic chef repo.</p>

<h3>Cookbook build pipeline</h3>

<p>Cookbook testing pipeline in CI can be like</p>

<center><img src='/images/plantuml/ab6f5f1b2a416015f8301be78a3098d2.png'></center>


<h5>Lint</h5>

<p>rubocop is ruby static code analyzer and foodcritic is lint tool, they mainly target the code conventions,
foodcritic also check some coding error like invalid resource actions.</p>

<h5>Unit Tests:</h5>

<p>chef spec is unit testing framework which is based upon rspec of ruby land and is pseudo convergence
framework means it run cookbook locally without  without actually converging a node, the benefit it provide is fast feedback and good for testing template and configuration
files, permissions etc&#8230; , other tools like searchef and chef-zero
plays well with it.</p>

<h4>Integration Tests:</h4>

<p>Test kitchen is post convergence framework and it spawn a machine for running integration tests in isolated environment.
it support various test backend like bats and server spec, test kitchen tests are slower than unit tests test but it test actual system convergence and ensure that target system is configured properly, ideal for testing cookbooks in different distros.</p>

<p>test kitchen with vagrant based approach is slow and you can use
<a href="/blog/2013/10/15/testing-cookbook-with-docker-and-test-kitchen/">container based approach</a> for faster feedback.</p>

<h4>Cookbook for setting up CI server</h4>

<p>we have integrated docker in our CI server and are using test kitchen with docker plugin for running integration tests.
here is <a href="https://github.com/codeignition/cookbook-pipeline">cookbook</a> which set up Jenkins, Docker and required packages and create builds jobs from attributes.</p>

<h2>Follow Up</h2>

<p>Once automated test suits and CI server in place, then it open the further doors for automating other knife related tasks for uploading cookbook and bumping environments. the next article will cover this
part in detail.</p>
</div>

</article>

	<div class="share">
	<div class="share_icon_group addthis_toolbox addthis_default_style addthis_32x32_style">
	
  <a class="share_icon addthis_button_preferred_1"></a>
	
	
	
	<a class="share_icon addthis_button_preferred_4"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid="></script>
</div>


</div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - timusg -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

<p>Theme: <a href="https://github.com/qingwang/octopress-theme-yinyang">YinYang</a></p>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-39717062-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>



		</div>
	</div>
</body>
</html>
